```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• 
â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— 
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—
â•šâ•â•â•â•â•â•â•   â•šâ•â•    â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•
                                           
â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
```

# TELEGRAM BOT :: ERPNEXT STOCK OPERATIONS INTERFACE

```
PROJECT: ERPNext Stock Manager Integration
RUNTIME: Python 3.10+ | Telegram Bot API
INTEGRATION: ERPNext v15.x via RESTful API
ARCHITECTURE: Standalone bot with SQLite persistence
LICENSE: MIT
```

---

## SYSTEM OVERVIEW

```
Self-contained Telegram bot providing mobile interface for ERPNext warehouse 
operations. Enables stock managers to perform inventory transactions, view 
items, manage stock entries, process purchase receipts, and handle delivery 
notes through Telegram messenger interface.

CRITICAL: ERPNext API credentials required for each user. Bot authenticates 
          individual users via their ERPNext API key/secret pairs.
```

---

## CAPABILITY MATRIX

```
CORE OPERATIONS
â”œâ”€â”€ API Key Management
â”‚   â”œâ”€â”€ User authentication via 14-18 character API key/secret
â”‚   â”œâ”€â”€ Credential validation against ERPNext instance
â”‚   â””â”€â”€ Multi-user credential storage (encrypted SQLite)
â”‚
â”œâ”€â”€ Item Search & Lookup
â”‚   â”œâ”€â”€ Inline search with autocomplete
â”‚   â”œâ”€â”€ Item details retrieval (code, name, UOM)
â”‚   â””â”€â”€ Real-time ERPNext Item DocType queries
â”‚
â”œâ”€â”€ Stock Entry Workflow
â”‚   â”œâ”€â”€ Material Receipt creation
â”‚   â”œâ”€â”€ Material Issue processing
â”‚   â”œâ”€â”€ Interactive item/warehouse selection
â”‚   â”œâ”€â”€ Quantity input validation
â”‚   â”œâ”€â”€ Draft/Submit/Cancel operations
â”‚   â””â”€â”€ Stock Entry approval workflow
â”‚
â”œâ”€â”€ Purchase Receipt Management
â”‚   â”œâ”€â”€ View existing purchase receipts
â”‚   â”œâ”€â”€ Create new purchase receipts via bot
â”‚   â”œâ”€â”€ Supplier selection (inline query)
â”‚   â”œâ”€â”€ Item addition with quantities
â”‚   â”œâ”€â”€ Approval/cancellation workflows
â”‚   â””â”€â”€ Multi-step warehouse assignment
â”‚
â””â”€â”€ Delivery Note Processing
    â”œâ”€â”€ View existing delivery notes
    â”œâ”€â”€ Create delivery notes via bot
    â”œâ”€â”€ Customer selection (inline query)
    â”œâ”€â”€ Item addition with quantities
    â”œâ”€â”€ Approval/cancellation workflows
    â””â”€â”€ Multi-step shipping operations

WORKFLOW ARCHITECTURE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram User Interface                  â”‚
â”‚  (Mobile/Desktop Client)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stock Manager Bot                        â”‚
â”‚  â”œâ”€â”€ Command Handlers                     â”‚
â”‚  â”œâ”€â”€ Inline Query Processors              â”‚
â”‚  â”œâ”€â”€ Callback Query Router                â”‚
â”‚  â””â”€â”€ Conversation State Machine           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
      â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLite DB   â”‚  â”‚ ERPNext API  â”‚
â”‚ (Creds)     â”‚  â”‚ (REST)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## TECHNICAL REQUIREMENTS

```
RUNTIME ENVIRONMENT
â”œâ”€â”€ Python: 3.10 or higher
â”œâ”€â”€ Docker Engine: 24+ (for containerized deployment)
â”œâ”€â”€ Docker Compose: v2+ plugin
â””â”€â”€ GNU Make: 4.0+ (optional, for convenience commands)

PYTHON DEPENDENCIES
â”œâ”€â”€ python-telegram-bot[rate-limiter]: >=21.2
â”œâ”€â”€ requests: >=2.32
â””â”€â”€ python-dotenv: >=1.0

EXTERNAL SERVICES
â”œâ”€â”€ Telegram Bot API ........... Bot token from @BotFather
â””â”€â”€ ERPNext Instance ........... v15.x with API access enabled

SYSTEM RESOURCES
â”œâ”€â”€ RAM: 256MB minimum (512MB recommended)
â”œâ”€â”€ Storage: 50MB application + database growth
â””â”€â”€ Network: Persistent internet connection
```

---

## DEPLOYMENT PROTOCOLS

### [PROTOCOL 1] RAPID DEPLOYMENT (Docker Compose + Make)

```bash
# Step 1: Acquire source code
git clone https://github.com/WIKKIwk/ERPNext_stock_manager_tg_integration.git
cd ERPNext_stock_manager_tg_integration

# Step 2: Configure environment
cp .env.example .env
nano .env  # Configure STOCK_BOT_TOKEN, FRAPPE_BASE_URL, etc.

# Step 3: Deploy via Make
make           # Equivalent to: docker compose up --build

# Container logs (real-time)
make logs

# Shutdown
make down
```

**DEPLOYMENT SEQUENCE (Automated):**
1. Docker image build (Python 3.11-slim base)
2. Dependency installation (pip install .)
3. Container orchestration startup
4. SQLite database initialization
5. Telegram Bot API connection
6. Long polling activation

**DATA PERSISTENCE:**
- SQLite database located at `/app/data/stock_manager.sqlite3`
- Host mount point: `./data/` (automatically created)
- Credentials encrypted at rest using SQLite extensions

### [PROTOCOL 2] LOCAL DEVELOPMENT DEPLOYMENT

```bash
# Step 1: Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Step 2: Install package (editable mode)
pip install -e .

# Step 3: Environment configuration
cp .env.example .env
nano .env  # Required: STOCK_BOT_TOKEN, FRAPPE_BASE_URL

# Step 4: Launch bot
python -m stock_manager_bot

# Note: python-dotenv automatically loads .env file
# No manual export of environment variables required
```

---

## CONFIGURATION MATRIX

### MANDATORY ENVIRONMENT VARIABLES

```env
# Telegram Bot Authentication
STOCK_BOT_TOKEN=YOUR_BOT_TOKEN_FROM_BOTFATHER

# ERPNext Instance Configuration
FRAPPE_BASE_URL=https://your-erp-domain.com
# Note: No trailing slash

# Company Configuration
ERP_COMPANY=your_company_name
# Must match ERPNext Company DocType name exactly
```

### STOCK ENTRY CONFIGURATION

```env
# Stock Entry Naming Series Template
STOCK_ENTRY_SERIES=MAT-STE-.YYYY.-.#####
# Format follows ERPNext naming series convention
# Example result: MAT-STE-2025-00001
```

### PURCHASE RECEIPT CONFIGURATION

```env
# Purchase Receipt Naming Series (Optional)
PURCHASE_RECEIPT_SERIES=MAT-PRE-.YYYY.-.#####
# Default uses ERPNext system default if not specified
```

### DELIVERY NOTE CONFIGURATION

```env
# Delivery Note Naming Series (Optional)
DELIVERY_NOTE_SERIES=MAT-DN-.YYYY.-.#####
# Default uses ERPNext system default if not specified
```

### ADVANCED CONFIGURATION

```env
# API Verification Endpoint (Default: ERPNext standard)
ERP_VERIFY_ENDPOINT=/api/method/frappe.auth.get_logged_user
# Used to validate API credentials on bot /start

# SQLite Database Path
STOCK_BOT_DB_PATH=./stock_manager_bot.sqlite3
# Relative to working directory or absolute path

# Inline Query Result Limits
ITEM_LIMIT=25               # Item search results
WAREHOUSE_LIMIT=25          # Warehouse selection results
SUPPLIER_LIMIT=25           # Supplier search results
PURCHASE_RECEIPT_LIMIT=25   # Purchase receipt list
CUSTOMER_LIMIT=25           # Customer search results
DELIVERY_NOTE_LIMIT=25      # Delivery note list
```

---

## OPERATIONAL PROCEDURES

### INITIAL USER AUTHENTICATION

```
User Workflow:
[1] User sends /start to bot
[2] Bot requests ERPNext API credentials
[3] User provides 14-18 character API key
[4] User provides corresponding API secret
[5] Bot validates credentials against ERPNext
[6] If valid: credentials stored encrypted, main menu displayed
[7] If invalid: error message, re-prompt for credentials

API Key Requirements:
- Length: 14-18 alphanumeric characters
- Format: Obtained from ERPNext User Profile
- Permissions: Requires ERPNext API access enabled
- Validation: Real-time verification via ERPNext API call
```

### ITEM SEARCH INTERFACE

```
Access Method:
â”œâ”€â”€ Command: /items
â”œâ”€â”€ Keyboard Button: "ðŸ“¦ Buyumlar"
â””â”€â”€ Inline Query: @bot_username items [search query]

Search Workflow:
[1] User initiates item search
[2] Bot presents inline query interface
[3] User types search query (item code or name)
[4] Bot queries ERPNext Item DocType
[5] Real-time results displayed (max: ITEM_LIMIT)
[6] User selects item from list
[7] Bot displays full item details
    â”œâ”€â”€ Item Code
    â”œâ”€â”€ Item Name
    â”œâ”€â”€ UOM (Unit of Measure)
    â””â”€â”€ Additional metadata
```

### STOCK ENTRY CREATION WORKFLOW

```
Command: /entry

Stage 1: Entry Type Selection
â”œâ”€â”€ Material Receipt (incoming goods)
â””â”€â”€ Material Issue (outgoing goods)

Stage 2: Item Selection
â”œâ”€â”€ Inline query activation
â”œâ”€â”€ Search & select Item DocType
â””â”€â”€ Item code captured

Stage 3: Warehouse Selection
â”œâ”€â”€ Inline query activation
â”œâ”€â”€ Search & select Warehouse DocType
â”œâ”€â”€ Target warehouse (receipt) OR Source warehouse (issue)
â””â”€â”€ Warehouse code captured

Stage 4: Quantity Input
â”œâ”€â”€ Numeric input validation
â”œâ”€â”€ Decimal support (e.g., 12.5)
â””â”€â”€ Positive value enforcement

Stage 5: Submission
â”œâ”€â”€ Stock Entry DocType creation via API
â”œâ”€â”€ Automatic draft generation
â”œâ”€â”€ Inline approval buttons
    â”œâ”€â”€ Submit (docstatus=1)
    â”œâ”€â”€ Cancel (docstatus=2)
    â””â”€â”€ Delete (remove from system)

Entry States:
â”œâ”€â”€ Draft (docstatus=0) .......... Editable, not in ledger
â”œâ”€â”€ Submitted (docstatus=1) ...... Posted to ledger, immutable
â””â”€â”€ Cancelled (docstatus=2) ...... Reversed in ledger, archived
```

### PURCHASE RECEIPT WORKFLOW

```
Command: /purchase

Viewing Existing Receipts:
[1] Bot queries Purchase Receipt DocType
[2] Results displayed with filters:
    â”œâ”€â”€ Supplier name
    â”œâ”€â”€ Posting date
    â”œâ”€â”€ Document status (Draft/Submitted/Cancelled)
    â””â”€â”€ Total amount
[3] User selects receipt for details
[4] Action buttons provided:
    â”œâ”€â”€ Approve/Submit (if draft)
    â”œâ”€â”€ Cancel (if submitted)
    â””â”€â”€ Delete (if draft)

Creating New Receipt:
[1] Bot initiates creation workflow
[2] Supplier selection (inline query)
[3] Item addition loop:
    â”œâ”€â”€ Select item (inline query)
    â”œâ”€â”€ Enter quantity
    â”œâ”€â”€ Enter rate (price)
    â”œâ”€â”€ Option: Add more items
[4] Warehouse assignment
[5] Review & confirm
[6] Submit to ERPNext API
[7] Success confirmation with doc ID
```

### DELIVERY NOTE WORKFLOW

```
Command: /delivery

Workflow Mirrors Purchase Receipt:
â”œâ”€â”€ Customer selection (instead of supplier)
â”œâ”€â”€ Item addition with quantities & rates
â”œâ”€â”€ Warehouse assignment (source warehouse)
â”œâ”€â”€ Submission to ERPNext
â””â”€â”€ Status management (draft/submit/cancel)

Document States:
â”œâ”€â”€ Draft .................. Editable, not shipped
â”œâ”€â”€ Submitted .............. Inventory deducted
â””â”€â”€ Cancelled .............. Shipment reversed
```

### CREDENTIAL MANAGEMENT

```
View Stored Credentials:
Command: /apic
Output: Displays masked API key (first 4 + last 4 chars visible)

Clear Credentials:
Command: /clear
Action: Removes stored credentials, requires re-authentication

Security Notes:
- Credentials stored encrypted in SQLite
- No plaintext credential storage
- Per-user isolation (user_id as key)
- Bot restart preserves credentials
```

---

## COMMAND REFERENCE

```
AUTHENTICATION & SETUP
/start ..................... Initialize bot, trigger credential input
/help ...................... Display command reference

DATA OPERATIONS
/items ..................... Open item search interface
/entry ..................... Stock entry menu (receipt/issue)
/purchase .................. Purchase receipt management
/delivery .................. Delivery note operations

ADMINISTRATIVE
/apic ...................... View stored API credentials (masked)
/clear ..................... Clear stored credentials
/cancel .................... Abort current workflow/conversation

Note: All commands require prior authentication via /start
      Commands can be triggered via inline keyboard buttons
```

---

## PROJECT STRUCTURE

```
stock-manager-bot/
â”œâ”€â”€ docker-compose.yml ............... Orchestration configuration
â”œâ”€â”€ Dockerfile ....................... Container image definition
â”œâ”€â”€ Makefile ......................... Build automation
â”œâ”€â”€ pyproject.toml ................... Python package metadata
â”œâ”€â”€ README.md ........................ This documentation
â”œâ”€â”€ .env.example ..................... Environment template
â”œâ”€â”€ .gitignore ....................... Version control exclusions
â”‚
â””â”€â”€ stock_manager_bot/ ............... Application source
    â”œâ”€â”€ __init__.py .................. Package initialization
    â”œâ”€â”€ __main__.py .................. Entry point (python -m)
    â”œâ”€â”€ bot.py ....................... Core bot logic (3000+ lines)
    â”œâ”€â”€ config.py .................... Configuration loader
    â”œâ”€â”€ storage.py ................... SQLite database interface
    â”œâ”€â”€ purchase.py .................. Purchase receipt handlers
    â””â”€â”€ delivery.py .................. Delivery note handlers

Data Persistence:
./data/ .............................. SQLite database location
â””â”€â”€ stock_manager.sqlite3 ............ User credentials & state
```

---

## MAKEFILE AUTOMATION

```bash
make ................... Build and start (docker compose up --build)
make logs .............. Stream container logs (follow mode)
make down .............. Stop and remove containers
make restart ........... Equivalent to: make down && make

Advanced Usage:
make build ............. Build image without starting
make ps ................ List running containers
make exec .............. Open shell in container
```

---

## DIAGNOSTIC PROCEDURES

### ISSUE: Bot Not Responding

```
Diagnosis Sequence:
[1] Verify bot token
    $ echo $STOCK_BOT_TOKEN
    Expected: Numeric:Alphanumeric format
    
[2] Check bot process
    $ docker ps | grep stock_manager
    $ docker logs stock_manager_bot
    
[3] Test Telegram API connectivity
    $ curl https://api.telegram.org/bot$STOCK_BOT_TOKEN/getMe
    Expected: JSON with bot details
    
[4] Review application logs
    $ docker logs stock_manager_bot --tail 50

Resolution:
- Regenerate bot token if compromised (@BotFather /token)
- Verify firewall rules allow HTTPS to api.telegram.org
- Check Docker container health: docker inspect stock_manager_bot
```

### ISSUE: ERPNext API Connection Failures

```
Diagnosis Sequence:
[1] Verify ERPNext instance accessibility
    $ curl -I https://your-erp-domain.com
    Expected: HTTP 200 or 301/302
    
[2] Test API endpoint
    $ curl https://your-erp-domain.com/api/method/frappe.auth.get_logged_user \
      -H "Authorization: token API_KEY:API_SECRET"
    
[3] Check Docker DNS resolution
    $ docker exec stock_manager_bot nslookup your-erp-domain.com
    
[4] Review ERPNext API logs
    Navigate: ERPNext â†’ Setup â†’ Error Log

Resolution:
- Verify API access enabled in ERPNext System Settings
- Check user API key has not expired
- Confirm company name matches ERPNext Company DocType
- Review ERPNext User permissions for API user
```

### ISSUE: Database Locked Errors

```
Diagnosis:
SQLite database locked due to concurrent access or interrupted transaction

Resolution:
$ docker exec stock_manager_bot rm /app/data/stock_manager.sqlite3.lock
$ docker restart stock_manager_bot

Prevention:
- Avoid manual database file manipulation while bot running
- Use bot commands for all operations
- Regular database backups recommended
```

### DEPENDENCY ISSUES

```bash
# Rebuild container with fresh dependencies
make down
docker rmi stock-manager-bot:latest
make

# Local development dependency refresh
pip install --upgrade pip
pip install -e . --force-reinstall --no-cache-dir

# Verify installed versions
pip list | grep telegram
pip list | grep requests
```

---

## SECURITY CONSIDERATIONS

```
CREDENTIAL STORAGE
â”œâ”€â”€ Encryption: SQLite database with application-level encryption
â”œâ”€â”€ Isolation: Per-user credential partitioning (user_id indexed)
â”œâ”€â”€ Transmission: HTTPS only (Telegram API enforced)
â””â”€â”€ Lifetime: Persistent until user executes /clear

API KEY SECURITY
â”œâ”€â”€ Validation: Server-side verification on each /start
â”œâ”€â”€ Rate Limiting: Telegram Bot API rate limiter integrated
â”œâ”€â”€ Rotation: Recommended 90-day rotation cycle
â””â”€â”€ Scope: Limited to ERPNext API permissions

BEST PRACTICES
â”œâ”€â”€ Never commit .env file to version control
â”œâ”€â”€ Use environment-specific .env files (dev/prod)
â”œâ”€â”€ Regularly update dependencies (pip install -U)
â”œâ”€â”€ Monitor Docker logs for suspicious activity
â”œâ”€â”€ Implement IP whitelisting on ERPNext firewall
â””â”€â”€ Use separate ERPNext API users per bot instance
```

---

## DEVELOPMENT GUIDELINES

### CONTRIBUTION WORKFLOW

```
[1] Fork repository
[2] Clone to local development environment
[3] Create feature branch
    $ git checkout -b feature/description
    
[4] Implement changes
    - Follow PEP 8 style guidelines
    - Add type hints to all functions
    - Document complex logic with inline comments
    
[5] Test locally
    $ python -m stock_manager_bot
    
[6] Commit with descriptive messages
    Format: type(scope): description
    Example: feat(purchase): add multi-item support
    
[7] Push to fork
    $ git push origin feature/description
    
[8] Open pull request with detailed description
```

### CODE ARCHITECTURE

```
bot.py (Core)
â”œâ”€â”€ StockManagerBot class ......... Main bot controller
â”œâ”€â”€ Command handlers .............. /start, /entry, /purchase, etc.
â”œâ”€â”€ Callback query router ......... Button press handling
â”œâ”€â”€ Inline query processor ........ Search functionality
â””â”€â”€ Error handler ................. Global exception catcher

purchase.py (Mixin)
â”œâ”€â”€ PurchaseFlowMixin class ....... Purchase receipt workflows
â”œâ”€â”€ Supplier selection ............ Inline query handler
â”œâ”€â”€ Item addition loop ............ Multi-item support
â””â”€â”€ Approval workflow ............. Submit/cancel operations

delivery.py (Mixin)
â”œâ”€â”€ DeliveryFlowMixin class ....... Delivery note workflows
â”œâ”€â”€ Customer selection ............ Inline query handler
â”œâ”€â”€ Item addition loop ............ Multi-item support
â””â”€â”€ Shipping workflow ............. Submit/cancel operations

storage.py
â”œâ”€â”€ StockStorage class ............ SQLite interface
â”œâ”€â”€ Credential CRUD operations .... Encrypted storage
â”œâ”€â”€ Draft management .............. Temporary workflow state
â””â”€â”€ Schema migrations ............. Database versioning

config.py
â”œâ”€â”€ StockBotConfig dataclass ...... Configuration schema
â”œâ”€â”€ Environment variable loader ... .env parsing
â””â”€â”€ Validation logic .............. Required field checks
```

---

## ROADMAP & FUTURE ENHANCEMENTS

```
Planned Features:
â”œâ”€â”€ Stock Reconciliation .......... Inventory count adjustments
â”œâ”€â”€ Batch/Serial Number Support ... Advanced tracking
â”œâ”€â”€ Multi-language Interface ...... I18n implementation
â”œâ”€â”€ Webhook Mode .................. Alternative to long polling
â”œâ”€â”€ Advanced Reporting ............ PDF generation via bot
â””â”€â”€ Integration with ERPNext Notifications
```

---

## LICENSE

```
MIT License

Copyright (c) 2025 Abdulfattox Qurbonov

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## SUPPORT & CONTRIBUTIONS

```
Issue Reporting:
Platform: GitHub Issues
URL: https://github.com/WIKKIwk/ERPNext_stock_manager_tg_integration/issues

Required Information:
â”œâ”€â”€ ERPNext version
â”œâ”€â”€ Python version
â”œâ”€â”€ Docker version (if containerized)
â”œâ”€â”€ Bot token validity status
â”œâ”€â”€ Error messages (full traceback)
â””â”€â”€ .env configuration (sanitized)

Response SLA:
â”œâ”€â”€ Critical: 24 hours
â”œâ”€â”€ High: 72 hours
â””â”€â”€ Normal: Best effort

Pull Requests:
- Include tests for new features
- Update documentation accordingly
- Follow existing code style
- Provide clear commit messages
```

---

```
PROJECT: Stock Manager Bot for ERPNext
VERSION: 0.1.0
LAST_UPDATED: 2025-12-26
MAINTAINER: Abdulfattox Qurbonov
RUNTIME: Python 3.10+ | Telegram Bot API 21.2+
STATUS: PRODUCTION_READY
```

**END DOCUMENTATION**
